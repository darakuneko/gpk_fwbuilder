# GPK FWMaker APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰

## æº–å‚™å®Œäº†ã—ãŸã‚‚ã®

âœ… **Vitestç’°å¢ƒæ§‹ç¯‰å®Œäº†**
- Vitestã€SuperTestã€TypeScriptå‹å®šç¾©ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
- vitest.config.tsè¨­å®šå®Œäº†
- ãƒ†ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆæ¸ˆã¿

âœ… **ä½œæˆæ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«**
```
server/
â”œâ”€â”€ vitest.config.ts
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ setup.ts
â”‚   â”œâ”€â”€ helpers/
â”‚   â”‚   â”œâ”€â”€ test-server.ts
â”‚   â”‚   â”œâ”€â”€ test-client.ts
â”‚   â”‚   â””â”€â”€ mock-data.ts
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â””â”€â”€ vial2c.test.ts  âœ…å‹•ä½œç¢ºèªæ¸ˆã¿
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ basic.test.ts
â”‚       â”œâ”€â”€ basic.mock.test.ts
â”‚       â”œâ”€â”€ qmk.test.ts
â”‚       â””â”€â”€ vial.test.ts
```

âœ… **NPMã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ æ¸ˆã¿**
```json
{
  "scripts": {
    "test": "vitest",
    "test:run": "vitest run", 
    "test:watch": "vitest watch",
    "test:coverage": "vitest run --coverage",
    "test:api": "vitest run tests/api",
    "test:unit": "vitest run tests/unit"
  }
}
```

## å‹•ä½œç¢ºèªæ¸ˆã¿ãƒ†ã‚¹ãƒˆ

### âœ… å˜ä½“ãƒ†ã‚¹ãƒˆ
```bash
npm run test:unit
```

**çµæœ**: å…¨6ãƒ†ã‚¹ãƒˆæˆåŠŸ
- vial2cé–¢æ•°ã®åŸºæœ¬å‹•ä½œ
- ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚¨ã‚¤ãƒªã‚¢ã‚¹è§£æ±º

## ç¾åœ¨ã®èª²é¡Œã¨è§£æ±ºæ–¹æ³•

### APIãƒ†ã‚¹ãƒˆã®èª²é¡Œ

1. **QMKãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¾å­˜**: `/root/qmk_firmware`ãŒãƒ†ã‚¹ãƒˆç’°å¢ƒã«å­˜åœ¨ã—ãªã„
2. **ãƒãƒ¼ãƒˆç«¶åˆ**: æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã¨ãƒ†ã‚¹ãƒˆã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ãƒˆç«¶åˆ
3. **å¤–éƒ¨ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ**: å®Ÿéš›ã®gitã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹

### æ¨å¥¨è§£æ±ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ãƒ¢ãƒƒã‚¯ç’°å¢ƒï¼ˆæ¨å¥¨ï¼‰
```bash
# å®Œå…¨ã«ãƒ¢ãƒƒã‚¯åŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆ
npm run test:unit  # âœ… å‹•ä½œæ¸ˆã¿
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: Dockerç’°å¢ƒã§ã®APIãƒ†ã‚¹ãƒˆ
```bash
# Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker compose exec gpk_fwmaker npm run test:api
```

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³3: CI/CDçµ±åˆãƒ†ã‚¹ãƒˆ
- GitHub Actionsã§ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ
- QMKç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã‹ã‚‰APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

## æ‰‹å‹•APIãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰

ç¾åœ¨Dockerã‚³ãƒ³ãƒ†ãƒŠãŒå‹•ä½œã—ã¦ã„ã‚‹ãŸã‚ã€æ‰‹å‹•ã§ã®APIãƒ†ã‚¹ãƒˆãŒæœ€ã‚‚ç¢ºå®Ÿï¼š

```bash
# åŸºæœ¬å‹•ä½œç¢ºèª
curl http://127.0.0.1:3123/

# QMKã‚¿ã‚°å–å¾—
curl http://127.0.0.1:3123/tags/qmk

# ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆï¼ˆæ³¨æ„ï¼šæ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ï¼‰
curl -X POST -H "Content-Type: application/json" \
  -d '{"kb": "planck", "km": "default", "tag": "0.19.3"}' \
  http://127.0.0.1:3123/build/qmk
```

## ä»Šå¾Œã®æ”¹å–„æ¡ˆ

### 1. ãƒ†ã‚¹ãƒˆå°‚ç”¨è¨­å®š
```typescript
// tests/config/test-app.ts
import app from '../../src/app'

// ãƒ†ã‚¹ãƒˆç”¨ã«commandãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ¢ãƒƒã‚¯
export const testApp = app
```

### 2. Environmentå¤‰æ•°ã§ã®åˆ¶å¾¡
```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚
NODE_ENV=test npm run test:api
```

### 3. Docker Composeã§ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒ
```yaml
# docker-compose.test.yml
services:
  test:
    build: ./server
    environment:
      - NODE_ENV=test
    command: npm run test:run
```

## çµè«–

**ç¾æ™‚ç‚¹ã§ã®æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**:

1. âœ… **å˜ä½“ãƒ†ã‚¹ãƒˆ**: å®Œå…¨å‹•ä½œç¢ºèªæ¸ˆã¿
2. ğŸ”„ **æ‰‹å‹•APIãƒ†ã‚¹ãƒˆ**: Dockerã‚³ãƒ³ãƒ†ãƒŠçµŒç”±ã§ç¢ºèªæ¸ˆã¿
3. ğŸ“‹ **ä»Šå¾Œ**: ãƒ¢ãƒƒã‚¯ç’°å¢ƒã¾ãŸã¯CI/CDç’°å¢ƒã§ã®APIãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–

Vitestã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆç’°å¢ƒã¯æ­£å¸¸ã«æ§‹ç¯‰ã•ã‚Œã¦ãŠã‚Šã€å˜ä½“ãƒ†ã‚¹ãƒˆã¯å®Œå…¨ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚APIãƒ†ã‚¹ãƒˆã«ã¤ã„ã¦ã¯ã€å®Ÿéš›ã®QMKç’°å¢ƒä¾å­˜éƒ¨åˆ†ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ã‹ã€å®Œå…¨ãªç’°å¢ƒã‚’ç”¨æ„ã—ã¦ã‹ã‚‰ã®å®Ÿè¡ŒãŒå¿…è¦ã§ã™ã€‚